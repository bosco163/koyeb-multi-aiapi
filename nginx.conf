server {
    listen 8080;
    server_name localhost;

    # === 1. Grok2API (现在是主角，占用根目录) ===
    # 这样 /api/login 就会直接发给 Grok，解决登录报错问题
    location / {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # === 2. Qwen2API (移动到 /qwen) ===
    # 访问地址变更为: https://你的域名.koyeb.app/qwen
    location /qwen/ {
        # 核心：把 /qwen/xxx 重写为 /xxx 再发给后端
        rewrite ^/qwen/(.*) /$1 break;
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # === 3. DeepSeek (保持不变 /deepseek) ===
    location /deepseek/ {
        rewrite ^/deepseek/(.*) /$1 break;
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # === 4. Doubao (保持不变 /doubao) ===
    location /doubao/ {
        rewrite ^/doubao/(.*) /$1 break;
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # === 5. Edge TTS (保持不变 /tts) ===
    location /tts/ {
        rewrite ^/tts/(.*) /$1 break;
        proxy_pass http://127.0.0.1:5050;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
